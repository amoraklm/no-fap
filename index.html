<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø¯ÛŒØ§Ø¨ NoFap</title>
    <style>
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Regular.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        
        body {
            font-family: Vazirmatn, Tahoma, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 500px;
            width: 90%;
            background: rgba(255, 255, 255, 0.95);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .streak {
            font-size: 5rem;
            font-weight: bold;
            color: #27ae60;
            margin: 1.5rem 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .days-label {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 2rem;
        }
        
        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 1.2rem 2.5rem;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 1rem 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            font-family: inherit;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #status {
            margin-top: 1.5rem;
            color: #7f8c8d;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .info-box {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            border-right: 4px solid #3498db;
        }
        
        .loading {
            color: #3498db;
            font-style: italic;
        }
        
        .error {
            color: #e74c3c;
        }
        
        .success {
            color: #27ae60;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .streak {
                font-size: 4rem;
            }
            
            button {
                padding: 1rem 2rem;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Ø±Ú©ÙˆØ±Ø¯ NoFap Ø´Ù…Ø§</h1>
        
        <div class="streak" id="streak">0</div>
        <div class="days-label">Ø±ÙˆØ² Ù¾Ø§Ú©</div>
        
        <div class="info-box">
            <strong>Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´Ù…Ø§:</strong>
            <div id="userId" style="font-family: monospace; margin-top: 0.5rem; color: #2c3e50;"></div>
        </div>
        
        <button onclick="resetStreak()">ğŸ”„ Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
        
        <div id="status">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</div>
    </div>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        const GITHUB_USERNAME = 'amoraklm';
        const REPO_NAME = 'no-fap';
        const DATA_FILE_URL = `https://${GITHUB_USERNAME}.github.io/${REPO_NAME}/data.json`;
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯
        function getUserId() {
            let userId = localStorage.getItem('nofap_user_id');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 12);
                localStorage.setItem('nofap_user_id', userId);
            }
            return userId;
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ
        function displayUserId() {
            const userId = getUserId();
            document.getElementById('userId').textContent = userId;
        }
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§
        function calculateDays(startDate) {
            const start = new Date(startDate);
            const today = new Date();
            const timeDiff = today.getTime() - start.getTime();
            return Math.floor(timeDiff / (1000 * 3600 * 24));
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        async function loadData() {
            try {
                document.getElementById('status').textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª...';
                document.getElementById('status').className = 'loading';
                
                const response = await fetch(`${DATA_FILE_URL}?t=${new Date().getTime()}`);
                
                if (!response.ok) {
                    throw new Error('ÙØ§ÛŒÙ„ Ø¯Ø§Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯');
                }
                
                const data = await response.json();
                const userId = getUserId();
                const userData = data[userId];
                
                const streakElement = document.getElementById('streak');
                const statusElement = document.getElementById('status');
                
                if (userData && userData.startDate) {
                    const days = calculateDays(userData.startDate);
                    streakElement.textContent = days;
                    
                    const persianDate = new Date(userData.startDate).toLocaleDateString('fa-IR');
                    statusElement.innerHTML = `âœ… <strong>Ø´Ù…Ø§ Ø§Ø² ØªØ§Ø±ÛŒØ® ${persianDate} Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯ÛŒØ¯</strong><br>
                                              ğŸ’ª Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡! ØªÙˆ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ!`;
                    statusElement.className = 'success';
                } else {
                    streakElement.textContent = '0';
                    statusElement.innerHTML = 'ğŸ¯ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø³ÙØ± NoFapØŒ Ø¯Ú©Ù…Ù‡ "Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯';
                    statusElement.className = '';
                }
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('streak').textContent = '0';
                document.getElementById('status').innerHTML = 'âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø§ÛŒÙ†ØªØ±Ù†Øª Ù…ØªØµÙ„ Ø§Ø³Øª';
                document.getElementById('status').className = 'error';
            }
        }
        
        // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯
        function resetStreak() {
            const userId = getUserId();
            const issueTitle = `Reset Streak - User: ${userId}`;
            const issueBody = `Ù„Ø·ÙØ§Ù‹ Ø±Ú©ÙˆØ±Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø²ÛŒØ± Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†ÛŒØ¯:\n\nUser ID: ${userId}\n\nØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('fa-IR')}`;
            
            const githubUrl = `https://github.com/${GITHUB_USERNAME}/${REPO_NAME}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}`;
            
            document.getElementById('status').innerHTML = 'ğŸ“ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ GitHub...<br>Ù„Ø·ÙØ§Ù‹ Issue Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯';
            document.getElementById('status').className = 'loading';
            
            setTimeout(() => {
                window.open(githubUrl, '_blank');
                
                // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø§Ø¯Ù‡
                let checks = 0;
                const checkInterval = setInterval(() => {
                    loadData();
                    checks++;
                    if (checks > 10) { // Ø¨Ø¹Ø¯ Ø§Ø² 10 Ú†Ú© Ù…ØªÙˆÙ‚Ù Ø´ÙˆØ¯
                        clearInterval(checkInterval);
                    }
                }, 5000); // Ù‡Ø± 5 Ø«Ø§Ù†ÛŒÙ‡ Ú†Ú© Ú©Ù†Ø¯
                
            }, 1000);
        }
        
        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        function init() {
            displayUserId();
            loadData();
            
            // Ø±ÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡
            setInterval(loadData, 5 * 60 * 1000);
        }
        
        // Ø§Ø¬Ø±Ø§ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        document.addEventListener('DOMContentLoaded', init);
        
        // Ù‡Ù…Ú†Ù†ÛŒÙ† ÛŒÚ© Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ø±ÙØ±Ø´ Ø¯Ø³ØªÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') {
                loadData();
            }
        });
    </script>
</body>
</html>
