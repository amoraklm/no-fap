<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ردیاب NoFap - Amoraklm</title>
    <style>
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Regular.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        
        body {
            font-family: Vazirmatn, Tahoma, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem;
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 500px;
            width: 90%;
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .streak {
            font-size: 4rem;
            font-weight: bold;
            color: #27ae60;
            margin: 1rem 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .days-label {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 1.5rem;
        }
        
        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 1rem 0;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }
        
        #status {
            margin-top: 1.5rem;
            color: #7f8c8d;
            font-size: 0.9rem;
            line-height: 1.6;
            min-height: 60px;
        }
        
        .info-box {
            background: #f8f9fa;
            padding: 0.8rem;
            border-radius: 10px;
            margin: 1rem 0;
            font-size: 0.8rem;
        }
        
        .loading { color: #3498db; }
        .error { color: #e74c3c; }
        .success { color: #27ae60; }

        @media (max-width: 480px) {
            .container {
                padding: 1.5rem;
            }
            .streak {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 رکورد NoFap شما</h1>
        
        <div class="streak" id="streak">0</div>
        <div class="days-label">روز پاک</div>
        
        <div class="info-box">
            <strong>شناسه کاربری:</strong>
            <div id="userId" style="font-family: monospace; margin-top: 0.3rem; color: #2c3e50;"></div>
        </div>
        
        <button onclick="resetStreak()">🔄 شروع مجدد</button>
        <button onclick="loadData()">🔄 بروزرسانی</button>
        
        <div id="status">در حال بارگذاری اطلاعات...</div>
    </div>

    <script>
        const GITHUB_USERNAME = 'amoraklm';
        const REPO_NAME = 'no-fap';
        const DATA_FILE_URL = `https://${GITHUB_USERNAME}.github.io/${REPO_NAME}/data.json`;
        
        function getUserId() {
            let userId = localStorage.getItem('nofap_user_id');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 12);
                localStorage.setItem('nofap_user_id', userId);
            }
            return userId;
        }
        
        function displayUserId() {
            document.getElementById('userId').textContent = getUserId();
        }
        
        function calculateDays(startDate) {
            const start = new Date(startDate);
            const today = new Date();
            const timeDiff = today.getTime() - start.getTime();
            return Math.floor(timeDiff / (1000 * 3600 * 24));
        }
        
        async function loadData() {
            try {
                document.getElementById('status').textContent = 'در حال بارگذاری اطلاعات...';
                document.getElementById('status').className = 'loading';
                
                const response = await fetch(`${DATA_FILE_URL}?t=${new Date().getTime()}`);
                
                if (!response.ok) throw new Error('خطا در دریافت داده');
                
                const data = await response.json();
                const userId = getUserId();
                const userData = data[userId];
                
                if (userData && userData.startDate) {
                    const days = calculateDays(userData.startDate);
                    document.getElementById('streak').textContent = days;
                    
                    const persianDate = new Date(userData.startDate).toLocaleDateString('fa-IR');
                    document.getElementById('status').innerHTML = `✅ از تاریخ ${persianDate}<br>💪 ادامه بده!`;
                    document.getElementById('status').className = 'success';
                } else {
                    document.getElementById('streak').textContent = '0';
                    document.getElementById('status').textContent = 'برای شروع، دکمه "شروع مجدد" را بزنید';
                    document.getElementById('status').className = '';
                }
                
            } catch (error) {
                document.getElementById('streak').textContent = '0';
                document.getElementById('status').textContent = '⚠️ خطا در بارگذاری داده';
                document.getElementById('status').className = 'error';
            }
        }
        
        function resetStreak() {
            const userId = getUserId();
            const issueTitle = `Reset Streak - User: ${userId}`;
            const issueBody = `لطفاً رکورد کاربر زیر را ریست کنید:\nUser ID: ${userId}\nتاریخ: ${new Date().toLocaleDateString('fa-IR')}`;
            
            const githubUrl = `https://github.com/${GITHUB_USERNAME}/${REPO_NAME}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}`;
            
            document.getElementById('status').textContent = 'در حال باز کردن صفحه GitHub...';
            document.getElementById('status').className = 'loading';
            
            setTimeout(() => {
                window.open(githubUrl, '_blank');
                setInterval(loadData, 5000);
            }, 1000);
        }
        
        function init() {
            displayUserId();
            loadData();
            setInterval(loadData, 30000);
        }
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
